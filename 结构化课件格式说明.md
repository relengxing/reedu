# 结构化课件格式说明

## 概述

为了解决大模型生成的HTML课件与框架之间的匹配问题（特别是动画和交互功能），我们设计了一套结构化的课件格式规范。这套方案通过**数据属性标记**的方式，让大模型生成的课件能够被框架正确解析和执行。

## 核心优势

1. **无需JavaScript**：大模型不需要生成复杂的JavaScript代码，只需使用简单的数据属性
2. **框架统一处理**：所有动画和交互由框架统一管理，确保兼容性
3. **向后兼容**：自动识别旧课件的onclick模式（如showStep、resetSteps）
4. **易于生成**：大模型只需按照规范添加数据属性即可

## 动画支持

### 简化格式（推荐）

使用 `data-animate` 系列属性：

```html
<!-- 自动淡入 -->
<div data-animate="fade" data-animate-trigger="auto" data-animate-duration="1000">
  这个元素会在页面加载时自动淡入
</div>

<!-- 滑动动画 -->
<div data-animate="slide" 
     data-animate-trigger="scroll" 
     data-animate-direction="left"
     data-animate-duration="800">
  滚动到这里时会从左侧滑入
</div>

<!-- 缩放动画 -->
<div data-animate="scale" data-animate-trigger="click">
  点击时缩放
</div>
```

**支持的动画类型：**
- `fade`: 淡入淡出
- `slide`: 滑动（需配合 `data-animate-direction="left|right|up|down"`）
- `scale`: 缩放
- `rotate`: 旋转

**触发方式：**
- `auto`: 页面加载时自动播放
- `scroll`: 滚动到可见时播放
- `click`: 点击时播放
- `hover`: 悬停时播放

### 完整JSON格式（复杂动画）

```html
<div data-animation='{
  "id": "anim1",
  "type": "slide",
  "target": "[data-animation-id=\"anim1\"]",
  "duration": 1000,
  "delay": 200,
  "easing": "ease-in-out",
  "trigger": "auto",
  "properties": {
    "direction": "left",
    "distance": "100px"
  }
}'>
  复杂动画元素
</div>
```

## 交互支持

### 简化格式（推荐）

使用 `data-interactive` 和 `data-target` 属性：

```html
<!-- 切换显示/隐藏 -->
<button data-interactive="toggle" data-target="#content1">切换显示</button>
<div id="content1">这是可以切换显示的内容</div>

<!-- 显示目标元素 -->
<button data-interactive="show" data-target="#step1">显示步骤1</button>
<div id="step1" style="display:none;">步骤1内容</div>

<!-- 隐藏目标元素 -->
<button data-interactive="hide" data-target="#step1">隐藏步骤1</button>

<!-- 在多个元素间切换 -->
<button data-interactive="switch" data-target=".step-content">下一步</button>
```

**支持的交互类型：**
- `toggle`: 切换显示/隐藏
- `show`: 显示目标元素
- `hide`: 隐藏目标元素
- `switch`: 在多个元素间切换显示

### 完整JSON格式（复杂交互）

```html
<button data-interaction='{
  "id": "btn1",
  "type": "toggle",
  "target": "#content1",
  "trigger": "[data-interaction-id=\"btn1\"]"
}'>
  切换内容
</button>
```

## 向后兼容

框架会自动识别旧课件中的常见onclick模式：

```html
<!-- 这些会被自动转换为交互配置 -->
<button onclick="showStep(1)">显示步骤1</button>
<button onclick="resetSteps()">重置所有步骤</button>
```

**注意**：不要使用 `showSection`、`prevSection`、`nextSection` 等导航函数，这些会被框架移除。

## 最佳实践

1. **优先使用简化格式**：`data-animate` 和 `data-interactive` 更易读易写
2. **合理使用触发方式**：
   - `auto` 适合页面加载动画
   - `click` 适合交互式动画
   - `scroll` 适合滚动触发的动画
3. **避免冲突**：不要同时使用 `onclick` 和 `data-interactive`，选择一种方式
4. **测试交互**：确保目标元素的选择器正确（使用id或class）
5. **样式控制**：使用CSS控制初始状态，框架会处理交互后的状态

## 示例：完整的页面

```html
<section id="page1" data-section="1">
  <h1>标题</h1>
  
  <!-- 自动淡入的标题 -->
  <h2 data-animate="fade" data-animate-trigger="auto" data-animate-duration="800">
    这个标题会自动淡入
  </h2>
  
  <!-- 点击按钮显示内容 -->
  <button data-interactive="show" data-target="#answer">显示答案</button>
  <div id="answer" style="display:none;" data-animate="fade" data-animate-trigger="auto">
    这是答案内容
  </div>
  
  <!-- 滑动动画 -->
  <div data-animate="slide" 
       data-animate-trigger="scroll" 
       data-animate-direction="left"
       data-animate-duration="1000">
    滚动到这里时会从左侧滑入
  </div>
  
  <!-- 步骤切换 -->
  <div class="step" id="step1">
    <h3>步骤1</h3>
    <div class="step-content" style="display:none;">
      步骤1的内容
    </div>
  </div>
  
  <button onclick="showStep(1)">显示步骤1</button>
</section>
```

## 技术实现

### 解析流程

1. **HTML解析**：框架解析HTML，提取所有带有动画/交互标记的元素
2. **配置提取**：将数据属性转换为结构化配置（AnimationConfig / InteractionConfig）
3. **统一执行**：框架的动画处理器和交互处理器统一管理所有动画和交互

### 关键文件

- `src/utils/animationHandler.ts`: 动画和交互处理器
- `src/utils/coursewareParser.ts`: 课件解析器（提取动画/交互配置）
- `src/components/PageRenderer.tsx`: 页面渲染器（执行动画/交互）
- `src/components/PromptGenerator.tsx`: 提示词生成器（指导大模型生成）

## 提示词使用

在"提示词生成工具"中，系统会自动添加动画和交互的规范说明。大模型生成课件时，只需按照提示词中的要求添加相应的数据属性即可。

## 常见问题

**Q: 为什么我的动画不工作？**
A: 检查以下几点：
1. 是否正确使用了 `data-animate` 属性
2. 触发方式是否正确（auto/click/scroll/hover）
3. 目标元素的选择器是否正确

**Q: 为什么我的按钮点击没反应？**
A: 检查以下几点：
1. 是否正确使用了 `data-interactive` 和 `data-target` 属性
2. `data-target` 的选择器是否正确（建议使用id选择器）
3. 目标元素是否存在

**Q: 旧课件还能用吗？**
A: 可以！框架会自动识别 `onclick="showStep(数字)"` 和 `onclick="resetSteps()"` 模式，并转换为交互配置。

**Q: 可以自定义动画吗？**
A: 可以使用 `data-animation` 属性（JSON格式）来定义复杂的自定义动画，或者使用 `data-animate="custom"` 配合自定义CSS。

