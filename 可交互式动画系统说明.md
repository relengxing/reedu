# 可交互式动画系统说明

## 概述

本系统完全重新设计，专注于**可交互式动画**，支持：
- 动画序列控制（播放、暂停、重置、步骤前进/后退）
- 交互式内容展示（展开/收起答案、切换状态等）
- 动画与交互的联动

**注意：本系统不考虑向后兼容，完全面向新的课件格式。**

## 核心特性

### 1. 可交互式动画

支持复杂的动画序列，如：
- **火车动画**：火车通过隧道的分步演示
- **步骤动画**：教学步骤的可控展示
- **状态动画**：在不同状态间切换

**功能：**
- ✅ 播放/暂停控制
- ✅ 重置到初始状态
- ✅ 步骤前进/后退
- ✅ 跳转到指定步骤
- ✅ 自动播放（可选）
- ✅ 循环播放（可选）

### 2. 交互功能

支持多种交互模式：
- **展开/收起**：显示/隐藏答案、内容
- **切换**：在显示/隐藏间切换
- **状态切换**：在多个状态间循环切换
- **触发动画**：通过按钮触发动画播放

## 使用方法

### 可交互式动画

#### 基本结构

```html
<div class="animation-container" 
     data-interactive-animation='{
       "id": "my-animation",
       "type": "sequence",
       "container": ".animation-container",
       "initialStep": 0,
       "autoPlay": false,
       "steps": [...]
     }'>
  <!-- 动画元素 -->
  <!-- 控制按钮 -->
</div>
```

#### 完整示例：火车动画

```html
<div class="train-animation-container" 
     style="position: relative; width: 800px; height: 200px;"
     data-interactive-animation='{
       "id": "train-animation",
       "type": "sequence",
       "container": ".train-animation-container",
       "initialStep": 0,
       "autoPlay": false,
       "steps": [
         {
           "id": "step1",
           "name": "火车进入隧道",
           "target": ".train",
           "properties": {"left": "0px", "opacity": 1},
           "duration": 2000,
           "easing": "ease-in-out"
         },
         {
           "id": "step2",
           "name": "火车完全进入",
           "target": ".train",
           "properties": {"left": "200px", "opacity": 1},
           "duration": 2000
         },
         {
           "id": "step3",
           "name": "火车离开隧道",
           "target": ".train",
           "properties": {"left": "600px", "opacity": 1},
           "duration": 2000
         }
       ],
       "controls": {
         "play": ".btn-play",
         "pause": ".btn-pause",
         "reset": ".btn-reset",
         "next": ".btn-next",
         "prev": ".btn-prev",
         "stepButtons": ".step-buttons"
       }
     }'>
  
  <!-- 动画元素 -->
  <div class="tunnel" style="position: absolute; left: 200px; width: 400px; height: 100px; background: #666;"></div>
  <div class="train" style="position: absolute; left: -100px; font-size: 40px;">🚂</div>
  
  <!-- 控制按钮 -->
  <div class="animation-controls">
    <button class="btn-play">播放</button>
    <button class="btn-pause">暂停</button>
    <button class="btn-reset">重置</button>
    <button class="btn-prev">上一步</button>
    <button class="btn-next">下一步</button>
  </div>
  
  <!-- 步骤按钮（可选） -->
  <div class="step-buttons">
    <button data-step="0">步骤1</button>
    <button data-step="1">步骤2</button>
    <button data-step="2">步骤3</button>
  </div>
</div>
```

#### 配置说明

**动画类型（type）：**
- `sequence`: 序列动画，按步骤顺序播放
- `continuous`: 连续动画（持续播放，暂未实现）
- `state`: 状态动画（在不同状态间切换，暂未实现）

**步骤配置（steps）：**
- `id`: 步骤唯一标识
- `name`: 步骤名称（可选）
- `target`: CSS选择器，要动画的元素
- `properties`: CSS属性对象，如 `{"left": "100px", "opacity": 1, "transform": "scale(1.2)"}`
- `duration`: 动画持续时间（毫秒）
- `delay`: 延迟时间（毫秒，可选）
- `easing`: 缓动函数（可选，如 "ease-in-out", "linear"）

**控制按钮（controls）：**
- `play`: 播放按钮选择器
- `pause`: 暂停按钮选择器
- `reset`: 重置按钮选择器
- `next`: 下一步按钮选择器
- `prev`: 上一步按钮选择器
- `stepButtons`: 步骤按钮容器选择器（按钮需使用 `data-step="索引"` 标记）

### 交互功能

#### 展开/收起答案

```html
<button data-interactive-type="expand" data-target="#answer">显示答案</button>
<div id="answer" style="display:none;" class="collapsed">
  <p>这是答案内容</p>
</div>
```

#### 切换显示

```html
<button data-interactive-type="toggle" data-target="#content">切换显示</button>
<div id="content">可以切换显示的内容</div>
```

#### 触发动画

```html
<button data-interactive-type="trigger-animation" data-animation-id="train-animation">
  播放动画
</button>
```

#### 完整JSON格式

```html
<button data-interaction='{
  "id": "expand-answer",
  "type": "expand",
  "target": "#answer",
  "trigger": "[data-interaction-id=\"expand-answer\"]"
}'>
  显示答案
</button>
```

#### 支持的交互类型

- `expand`: 展开目标元素（显示）
- `collapse`: 收起目标元素（隐藏）
- `toggle`: 切换显示/隐藏
- `switch`: 在多个状态间切换
- `trigger-animation`: 触发动画（需指定 `data-animation-id`）
- `custom`: 自定义动作

## 技术实现

### 架构

1. **InteractiveAnimationHandler**: 管理可交互式动画
   - 动画状态管理
   - 播放控制（播放、暂停、重置）
   - 步骤控制（前进、后退、跳转）
   - 控制按钮绑定

2. **InteractionHandler**: 管理交互功能
   - 展开/收起处理
   - 切换处理
   - 动画触发
   - 状态管理

3. **解析器（coursewareParser）**: 从HTML提取配置
   - 提取 `data-interactive-animation` 属性
   - 提取 `data-interaction` 或 `data-interactive-type` 属性
   - 构建结构化配置对象

4. **渲染器（PageRenderer）**: 执行动画和交互
   - 初始化动画处理器
   - 初始化交互处理器
   - 管理生命周期

### 数据流

```
HTML (data属性) 
  → 解析器提取配置 
  → 构建配置对象 
  → 渲染器初始化处理器 
  → 用户交互 
  → 处理器执行动作
```

## 最佳实践

### 1. 动画设计

- **初始状态**：确保动画元素的初始CSS状态与第一步的properties匹配
- **步骤顺序**：按逻辑顺序定义步骤，确保动画流畅
- **持续时间**：合理设置duration，不要太快或太慢
- **控制按钮**：提供清晰的播放、暂停、重置按钮

### 2. 交互设计

- **展开/收起**：使用 `collapsed` 类标记初始隐藏的内容
- **目标选择器**：使用id选择器（`#id`）更可靠
- **按钮文本**：使用清晰的按钮文本（如"显示答案"、"隐藏答案"）

### 3. 性能优化

- **避免过多步骤**：序列动画步骤不要太多（建议<20步）
- **合理使用动画**：不要在同一页面使用太多动画
- **CSS属性**：优先使用transform和opacity，性能更好

## 示例场景

### 场景1：数学题展开答案

```html
<section>
  <h2>问题：解方程 x + 5 = 10</h2>
  <button data-interactive-type="expand" data-target="#answer">显示答案</button>
  <div id="answer" style="display:none;" class="collapsed">
    <p>x = 5</p>
  </div>
</section>
```

### 场景2：物理实验步骤动画

```html
<section>
  <div class="experiment-container" 
       data-interactive-animation='{
         "id": "experiment",
         "type": "sequence",
         "container": ".experiment-container",
         "steps": [
           {"target": ".step1", "properties": {"opacity": 1}, "duration": 1000},
           {"target": ".step2", "properties": {"opacity": 1}, "duration": 1000},
           {"target": ".step3", "properties": {"opacity": 1}, "duration": 1000}
         ],
         "controls": {"play": ".btn-play", "next": ".btn-next"}
       }'>
    <div class="step1" style="opacity: 0;">步骤1：准备材料</div>
    <div class="step2" style="opacity: 0;">步骤2：进行实验</div>
    <div class="step3" style="opacity: 0;">步骤3：观察结果</div>
    <button class="btn-play">播放</button>
    <button class="btn-next">下一步</button>
  </div>
</section>
```

## 注意事项

1. **不要使用JavaScript**：所有动画和交互都由框架处理，不要添加自定义JavaScript
2. **选择器准确性**：确保target和controls中的选择器正确
3. **CSS属性名**：在properties中使用标准的CSS属性名（如left, top, opacity, transform）
4. **初始状态**：动画元素的初始CSS状态应该与第一步匹配
5. **容器定位**：动画容器建议使用 `position: relative`

## 故障排除

**Q: 动画不播放？**
- 检查 `data-interactive-animation` 属性格式是否正确（JSON格式）
- 检查 `container` 选择器是否正确
- 检查 `target` 选择器是否能找到元素

**Q: 控制按钮没反应？**
- 检查 `controls` 中的选择器是否正确
- 确保按钮在动画容器内或可以通过选择器找到

**Q: 展开/收起不工作？**
- 检查 `data-interactive-type` 和 `data-target` 是否正确
- 确保目标元素存在
- 初始隐藏的元素应使用 `style="display:none;"` 和 `class="collapsed"`

